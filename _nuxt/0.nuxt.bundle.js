webpackJsonp([0],{368:function(t,e,r){r(382);var n=r(25)(r(373),r(388),"data-v-76a3d593",null);t.exports=n.exports},370:function(t,e,r){"use strict";r.d(e,"a",function(){return n});var n=function(t){return function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var a=r.pop();try{t.apply(void 0,r.concat([function(t){a(null,t)}]))}catch(t){a(t)}}}},373:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(377),a=r.n(n),o=r(378),i=r.n(o),l=r(376),c=r.n(l),s=r(210),u=r.n(s),d=r(35),f=r(76),p=r.n(f),h=r(95),m=r.n(h),g=r(370),v=r(0),y=r.n(v);e.default={data:function(){var t=function(t){return function(e,r,n){return r?r>0?n():n(new Error(t+"必须大于0")):n(new Error(t+"不能为0"))}};return{filterDate:"",date1:"",date2:"",tableLoading:!1,dateRange:{start:0,end:0},currentTab:"markDown",setting:{settleDay:25},typeForm:{code:"",unitPrice:0},typeRule:{code:[{required:!0,message:"请输入型号编号",trigger:"change"}],unitPrice:[{validator:t("加工单价"),trigger:"change"}]},selectDate:null,typeList:[],recordList:[],recordForm:{date:"",type:"",count:0,grossWeight:0,netWeight:0},recordRule:{date:[{required:!0,type:"number",message:"请选择入库日期",trigger:"change"}],type:[{required:!0,message:"请选择产品型号",trigger:"change"}],count:[{validator:t("入库数量"),trigger:"change"}],grossWeight:[{validator:t("毛重"),trigger:"change"}],netWeight:[{validator:t("净重"),trigger:"change"}]}}},middleware:["authenticated"],mounted:function(){var t=this;this.date2=Date.now(),this.createRef("type").orderByKey().on("value",function(e){t.typeList=m.a.map(e.val(),function(t,e){return u()({},t,{id:e})})||[]}),this.createRef("setting").on("value",function(e){var r=e.val();null===r?t.updateSetting(t.setting):t.setting=r})},methods:{editRecordForm:function(t){this.selectDate=new Date(t.date),this.recordForm={id:t.id,date:this.convertDateToMilliseconds(t.date),count:t.count,type:t.type,grossWeight:t.grossWeight,netWeight:t.netWeight}},toggleTableLoading:function(){return this.tableLoading=!this.tableLoading,!0},fetchRecordByStartAndEnd:function(t){var e=this,n=function(t){return e.createRef("type/"+t)},a=function(t){var e=n(t);return r.i(f.promisify)(r.i(g.a)(e.once.bind(e)))};this.createRef("record").orderByChild("date").startAt(t.start).endAt(t.end).once("value",function(t){p.a.all(m.a.map(t.val(),function(){var t=c()(i.a.mark(function t(r,n){var o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(r.type)("value");case 2:return o=t.sent,t.abrupt("return",u()({},r,{date:y()(r.date).format("YYYY/M/D"),id:n},o.val()));case 4:case"end":return t.stop()}},t,e)}));return function(e,r){return t.apply(this,arguments)}}())).then(function(t){e.recordList=t})})},updateSetting:function(t){this.createRef("setting").set(t)},convertDateToMilliseconds:function(t){return y()(t,"YYYY-MM-DD").valueOf()},deleteItemFromDb:function(t,e){var r=this;this.createRef(t).child(e).remove().then(function(){return toastr.success("删除成功")&&"record"===t&&r.fetchRecordByStartAndEnd(r.dateRange)}).catch(function(){return toastr.error("删除失败")})},submitForm:function(t){var e=this;this.$refs[t].validate(function(r){if(!r)return toastr.error("请核对无误再提交"),!1;e.toggleTableLoading();var n=e[t].id,o=e.createRef(/(.*)(Form)$/.exec(t)[1]),i=u()({},e[t]);delete i.id,n?o.update(a()({},n,i)).then(function(){return toastr.success("更新成功")&&e.toggleTableLoading()&&"recordForm"===t&&e.fetchRecordByStartAndEnd(e.dateRange)}).catch(function(){return toastr.error("更新失败")&&e.toggleTableLoading()}):o.push(i).then(function(){return toastr.success("添加成功")&&e.toggleTableLoading()&&"recordForm"===t&&e.fetchRecordByStartAndEnd(e.dateRange)}).catch(function(){return toastr.error("添加失败")&&e.toggleTableLoading()}),e.resetForm(t)})},resetForm:function(t){delete this[t].id,this.$refs[t].resetFields(),"recordForm"===t&&(this.selectDate=null)},createRef:function(t){return this.$firebase.database().ref(this.loggedUser.uid+"/"+t)},queryTypeAsync:function(t,e){var r=this.typeList;e(r.filter(function(e){return e.value.toLowerCase().indexOf(t.toLowerCase())>-1}))}},computed:u()({},r.i(d.mapGetters)(["loggedUser"])),watch:{filterDate:function(){if(this.filterDate.indexOf("-")>-1){var t=/(.*)-(.*)/.exec(this.filterDate),e=parseInt(t[1]),r=parseInt(t[2]);this.dateRange.end=y()(e+"-"+r+"-"+this.setting.settleDay,"YYYY-M-D").valueOf(),1===r?this.dateRange.start=y()(e-1+"-12-"+(this.setting.settleDay+1),"YYYY-M-D").valueOf():this.dateRange.start=y()(e+"-"+(r-1)+"-"+(this.setting.settleDay+1),"YYYY-M-D").valueOf()}else{var n=parseInt(this.filterDate);this.dateRange.start=y()(n+"-1-1","YYYY-M-D").valueOf(),this.dateRange.end=y()(n+"-12-31","YYYY-M-D").valueOf()}this.fetchRecordByStartAndEnd(this.dateRange)}}}},375:function(t,e,r){t.exports={default:r(379),__esModule:!0}},376:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=r(27),o=n(a);e.default=function(t){return function(){var e=t.apply(this,arguments);return new o.default(function(t,r){function n(a,i){try{var l=e[a](i),c=l.value}catch(t){return void r(t)}return l.done?void t(c):o.default.resolve(c).then(function(t){n("next",t)},function(t){n("throw",t)})}return n("next")})}}},377:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=r(375),o=n(a);e.default=function(t,e,r){return e in t?(0,o.default)(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},378:function(t,e,r){t.exports=r(383)},379:function(t,e,r){r(380);var n=r(6).Object;t.exports=function(t,e,r){return n.defineProperty(t,e,r)}},380:function(t,e,r){var n=r(20);n(n.S+n.F*!r(11),"Object",{defineProperty:r(12).f})},382:function(t,e){},383:function(t,e,r){(function(e){var n="object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this,a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=r(384),a)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}}).call(e,r(9))},384:function(t,e,r){(function(e,r){!function(e){"use strict";function n(t,e,r,n){var a=e&&e.prototype instanceof o?e:o,i=Object.create(a.prototype),l=new h(n||[]);return i._invoke=u(t,r,l),i}function a(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function i(){}function l(){}function c(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function s(t){function e(r,n,o,i){var l=a(t[r],t,n);if("throw"!==l.type){var c=l.arg,s=c.value;return s&&"object"==typeof s&&b.call(s,"__await")?Promise.resolve(s.__await).then(function(t){e("next",t,o,i)},function(t){e("throw",t,o,i)}):Promise.resolve(s).then(function(t){c.value=t,o(c)},i)}i(l.arg)}function n(t,r){function n(){return new Promise(function(n,a){e(t,r,n,a)})}return o=o?o.then(n,n):n()}"object"==typeof r&&r.domain&&(e=r.domain.bind(e));var o;this._invoke=n}function u(t,e,r){var n=D;return function(o,i){if(n===k)throw new Error("Generator is already running");if(n===S){if("throw"===o)throw i;return g()}for(r.method=o,r.arg=i;;){var l=r.delegate;if(l){var c=d(l,r);if(c){if(c===C)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===D)throw n=S,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=k;var s=a(t,e,r);if("normal"===s.type){if(n=r.done?S:R,s.arg===C)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=S,r.method="throw",r.arg=s.arg)}}}function d(t,e){var r=t.iterator[e.method];if(r===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,d(t,e),"throw"===e.method))return C;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}var n=a(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,C;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,C):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,C)}function f(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function p(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(f,this),this.reset(!0)}function m(t){if(t){var e=t[_];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(b.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=v,e.done=!0,e};return n.next=n}}return{next:g}}function g(){return{value:v,done:!0}}var v,y=Object.prototype,b=y.hasOwnProperty,w="function"==typeof Symbol?Symbol:{},_=w.iterator||"@@iterator",x=w.toStringTag||"@@toStringTag",F="object"==typeof t,L=e.regeneratorRuntime;if(L)return void(F&&(t.exports=L));L=e.regeneratorRuntime=F?t.exports:{},L.wrap=n;var D="suspendedStart",R="suspendedYield",k="executing",S="completed",C={},E={};E[_]=function(){return this};var Y=Object.getPrototypeOf,O=Y&&Y(Y(m([])));O&&O!==y&&b.call(O,_)&&(E=O);var j=l.prototype=o.prototype=Object.create(E);i.prototype=j.constructor=l,l.constructor=i,l[x]=i.displayName="GeneratorFunction",L.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===i||"GeneratorFunction"===(e.displayName||e.name))},L.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,x in t||(t[x]="GeneratorFunction")),t.prototype=Object.create(j),t},L.awrap=function(t){return{__await:t}},c(s.prototype),L.AsyncIterator=s,L.async=function(t,e,r,a){var o=new s(n(t,e,r,a));return L.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},c(j),j[x]="Generator",j.toString=function(){return"[object Generator]"},L.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},L.values=m,h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(p),!t)for(var e in this)"t"===e.charAt(0)&&b.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,n){return o.type="throw",o.arg=t,r.next=e,n&&(r.method="next",r.arg=v),!!n}if(this.done)throw t;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],o=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var i=b.call(a,"catchLoc"),l=b.call(a,"finallyLoc");if(i&&l){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&b.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,C):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),C},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),p(r),C}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;p(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:m(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=v),C}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,r(9),r(26))},388:function(t,e){t.exports={render:function(){var t=this,e=this,r=e.$createElement,n=e._self._c||r;return n("div",[n("el-tabs",{model:{value:e.currentTab,callback:function(t){e.currentTab=t}}},[n("el-tab-pane",{attrs:{label:"型号管理",name:"typeManage"}},[n("div",{staticClass:"panel panel-success panel-container"},[n("div",{staticClass:"panel-heading"},[n("h3",{staticClass:"panel-title"},[e._v("型号列表")])]),n("div",{staticClass:"panel-body"},[n("el-table",{staticStyle:{margin:"0 auto"},attrs:{data:e.typeList,border:""}},[n("el-table-column",{attrs:{prop:"code",label:"型号编号","min-width":"120"},scopedSlots:e._u([["default",function(t){return[n("span",{staticClass:"ellipsis",staticStyle:{width:"120px"}},[e._v("\n                  "+e._s(t.row.code)+"\n                ")])]}]])}),n("el-table-column",{attrs:{prop:"unitPrice",label:"加工单价","min-width":"100"},scopedSlots:e._u([["default",function(t){return[e._v("\n                "+e._s(t.row.unitPrice)+" 元\n              ")]}]])}),n("el-table-column",{attrs:{label:"操作","min-width":"150"},scopedSlots:e._u([["default",function(t){return[n("el-button",{attrs:{size:"small"},on:{click:function(r){e.typeForm=Object.assign({},t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){e.deleteItemFromDb("type",t.row.id)}}},[e._v("删除")])]}]])})],1)],1)]),n("div",{staticClass:"panel panel-info panel-container"},[n("div",{staticClass:"panel-heading"},[n("h3",{staticClass:"panel-title"},[e._v("添加/更新型号")])]),n("div",{staticClass:"panel-body"},[n("el-form",{ref:"typeForm",staticClass:"form",attrs:{model:e.typeForm,rules:e.typeRule,"label-width":"90px","label-position":"right"}},[n("el-form-item",{attrs:{label:"型号编号",prop:"code"}},[n("el-input",{model:{value:e.typeForm.code,callback:function(t){e.typeForm.code=t}}})],1),n("el-form-item",{attrs:{label:"加工单价",prop:"unitPrice",required:""}},[n("div",{staticClass:"numberWrapper"},[n("el-input-number",{attrs:{step:.05},model:{value:e.typeForm.unitPrice,callback:function(t){e.typeForm.unitPrice=t}}}),n("span",[e._v("元")])],1)]),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("typeForm")}}},[e._v("添加/更新")]),n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.resetForm("typeForm")}}},[e._v("重填")])],1)],1)],1)])]),n("el-tab-pane",{attrs:{label:"入库登记",name:"markDown"}},[n("div",{staticClass:"panel panel-info panel-container"},[n("div",{staticClass:"panel-heading"},[n("h3",{staticClass:"panel-title"},[e._v("入库记录")])]),n("div",{staticClass:"panel-body"},[n("h2",{staticStyle:{"text-align":"center","margin-top":"0"}},[e._v(e._s(e.filterDate))]),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{margin:"0 auto"},attrs:{data:e.recordList,border:"","element-loading-text":"拼命加载中"}},[n("el-table-column",{attrs:{prop:"date",label:"入库日期","min-width":"130"},scopedSlots:e._u([["default",function(t){return[n("el-icon",{attrs:{name:"time"}}),n("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.date))])]}]])}),n("el-table-column",{attrs:{prop:"count",label:"入库数量","min-width":"100"},scopedSlots:e._u([["default",function(t){return[e._v("\n                "+e._s(t.row.count)+" 个\n              ")]}]])}),n("el-table-column",{attrs:{prop:"grossWeight",label:"毛重","min-width":"100"},scopedSlots:e._u([["default",function(t){return[e._v("\n                "+e._s(t.row.grossWeight)+" kg\n              ")]}]])}),n("el-table-column",{attrs:{prop:"netWeight",label:"净重","min-width":"100"},scopedSlots:e._u([["default",function(t){return[e._v("\n                "+e._s(t.row.netWeight)+" kg\n              ")]}]])}),n("el-table-column",{attrs:{prop:"code",label:"型号编号","min-width":"120"},scopedSlots:e._u([["default",function(t){return[n("span",{staticClass:"ellipsis",staticStyle:{width:"120px"}},[e._v("\n                  "+e._s(t.row.code)+"\n                ")])]}]])}),n("el-table-column",{attrs:{prop:"unitPrice",label:"加工单价","min-width":"100"},scopedSlots:e._u([["default",function(t){return[e._v("\n                "+e._s(t.row.unitPrice)+" 元\n              ")]}]])}),n("el-table-column",{attrs:{label:"操作","min-width":"150"},scopedSlots:e._u([["default",function(t){return[n("el-button",{attrs:{size:"small"},on:{click:function(r){e.editRecordForm(Object.assign({},t.row))}}},[e._v("编辑")]),n("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){e.deleteItemFromDb("record",t.row.id)}}},[e._v("删除")])]}]])})],1),n("div",{staticStyle:{display:"flex","justify-content":"space-around","flex-wrap":"wrap","margin-top":"20px"}},[n("el-date-picker",{staticClass:"filterDate",attrs:{type:"year",placeholder:"请选择年"},on:{change:function(r){void 0!==r&&(e.date2=null,t.filterDate=r)}},model:{value:e.date1,callback:function(t){e.date1=t}}}),n("el-date-picker",{staticClass:"filterDate",attrs:{type:"month",placeholder:"请选择月"},on:{change:function(r){void 0!==r&&(e.date1=null,t.filterDate=r)}},model:{value:e.date2,callback:function(t){e.date2=t}}})],1)],1)]),n("div",{staticClass:"panel panel-success panel-container"},[n("div",{staticClass:"panel-heading"},[n("h3",{staticClass:"panel-title"},[e._v("添加/更新入库记录")])]),n("div",{staticClass:"panel-body"},[n("el-form",{ref:"recordForm",staticClass:"form",attrs:{model:e.recordForm,rules:e.recordRule,"label-width":"90px"}},[n("el-form-item",{attrs:{label:"入库日期",prop:"date"}},[n("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"选择日期"},on:{change:function(t){e.recordForm.date=e.convertDateToMilliseconds(t)}},model:{value:e.selectDate,callback:function(t){e.selectDate=t}}})],1),n("el-form-item",{attrs:{label:"入库数量",prop:"count",required:""}},[n("div",{staticClass:"numberWrapper"},[n("el-input-number",{attrs:{step:1},model:{value:e.recordForm.count,callback:function(t){e.recordForm.count=t}}}),n("span",[e._v("个")])],1)]),n("el-form-item",{attrs:{label:"毛重",prop:"grossWeight",required:""}},[n("div",{staticClass:"numberWrapper"},[n("el-input-number",{attrs:{step:.01},model:{value:e.recordForm.grossWeight,callback:function(t){e.recordForm.grossWeight=t}}}),n("span",[e._v("kg")])],1)]),n("el-form-item",{attrs:{label:"净重",prop:"netWeight",required:""}},[n("div",{staticClass:"numberWrapper"},[n("el-input-number",{attrs:{step:.01},model:{value:e.recordForm.netWeight,callback:function(t){e.recordForm.netWeight=t}}}),n("span",[e._v("kg")])],1)]),n("el-form-item",{attrs:{label:"产品型号",prop:"type"}},[n("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.recordForm.type,callback:function(t){e.recordForm.type=t}}},e._l(e.typeList,function(t){return n("el-option",{attrs:{label:t.code+" - "+t.unitPrice+"元",value:t.id}})}))],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("recordForm")}}},[e._v("添加/更新")]),n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.resetForm("recordForm")}}},[e._v("重填")])],1)],1)],1)])]),n("el-tab-pane",{attrs:{label:"设置",name:"setting"}},[n("div",{staticClass:"panel panel-success panel-container"},[n("div",{staticClass:"panel-heading"},[n("h3",{staticClass:"panel-title"},[e._v("设置")])]),n("div",{staticClass:"panel-body"},[n("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[n("span",[e._v("每月结账日")]),n("el-select",{staticStyle:{"margin-left":"20px"},on:{change:function(t){e.updateSetting(e.setting)}},model:{value:e.setting.settleDay,callback:function(t){e.setting.settleDay=t}}},e._l(28,function(t){return n("el-option",{attrs:{label:t+" 日",value:t}})}))],1)])])])],1)],1)},staticRenderFns:[]}}});